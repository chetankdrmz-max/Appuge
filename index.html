<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart FarmHer â€” Grow Good Sell Smart</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#10b981">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; margin:0; }
    /* start screen background swap */
    #start-screen { 
      background-size: cover; background-position: center; 
      min-height: 100vh; display:flex; align-items:center; justify-content:center;
    }
    @media (max-width:768px){
      #start-screen { background-image:url('icons/bg-mobile.jpg'); }
    }
    @media (min-width:769px){
      #start-screen { background-image:url('icons/bg-desktop.jpg'); }
    }
    .card { background:white; border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(2,6,23,0.08); width:100%; max-width:880px; }
    .btn { display:inline-flex; align-items:center; gap:6px; padding:10px 14px; border-radius:8px; font-weight:600; }
    .btn-green { background:#10b981; color:white; }
    .btn-dark { background:#0f172a; color:white; }
    .btn input[type=file]{display:none}
  </style>
</head>
<body>

  <!-- START SCREEN -->
  <div id="start-screen">
    <div class="card">
      <!-- Title -->
      <div style="display:flex;align-items:center;gap:12px;justify-content:space-between">
        <div style="display:flex;align-items:center;gap:12px">
          <img src="icons/Smartfarmher.png" style="width:48px;height:48px;border-radius:6px;object-fit:cover">
          <div>
            <h1 style="margin:0;font-size:26px;color:#10b981;font-weight:700">Smart FarmHer</h1>
            <div style="color:#374151;font-weight:600;margin-top:4px">Grow Good Sell Smart</div>
          </div>
        </div>
        <button id="open-help" style="background:none;border:none;color:#6b7280"><i class="fas fa-question-circle"></i></button>
      </div>

      <!-- Buttons moved to TOP -->
      <div class="mt-6 flex gap-3 justify-center flex-wrap">
        <button id="start-analysis-btn" class="btn btn-green"><i class="fas fa-cloud-download-alt"></i> Load Preloaded Data</button>
        <button id="load-local-btn" class="btn btn-dark"><i class="fas fa-save"></i> Load Saved</button>
      </div>

      <!-- File upload -->
      <div class="mt-5">
        <input id="file-input" type="file" accept=".csv,.xlsx,.xls,text/csv" class="w-full p-3 rounded border" />
      </div>

      <div class="text-sm text-gray-500 mt-3">
        Tip: import your CSV/XLSX file with market rows. Use saved data to keep it on your phone.  
        Use "Load Preloaded Data" to fetch dataset hosted in repo.
      </div>
    </div>
  </div>

  <!-- DASHBOARD (same as before, hidden initially) -->
  <div id="main-dashboard" class="hidden">
    <!-- full dashboard layout here (unchanged from previous file) -->
  </div>

<script>
const PRELOADED_RAW_URL = 'https://raw.githubusercontent.com/chetankdrmz-max/Smart_FarmHer/refs/heads/main/data/Raw_Concatenated.csv';
/* Simplified: on click fetch preloaded CSV and load */
document.getElementById('start-analysis-btn')?.addEventListener('click', async ()=>{
  try {
    alert('Loading preloaded dataset...');
    const resp = await fetch(PRELOADED_RAW_URL);
    if(!resp.ok) throw new Error('Fetch failed: ' + resp.status);
    const text = await resp.text();
    const rows = Papa.parse(text,{header:true,skipEmptyLines:true}).data;
    if(!rows.length){ alert('No rows found'); return; }
    localStorage.setItem('agri_dashboard_store_v1', JSON.stringify({rows, markets:[]}));
    document.getElementById('start-screen').style.display='none';
    document.getElementById('main-dashboard').classList.remove('hidden');
    location.reload(); // reload to refresh dashboard UI
  } catch(e){ alert('Preload failed: '+e.message); }
});

/* Load saved */
document.getElementById('load-local-btn')?.addEventListener('click', ()=>{
  const saved = localStorage.getItem('agri_dashboard_store_v1');
  if(!saved){ alert('No saved data'); return; }
  document.getElementById('start-screen').style.display='none';
  document.getElementById('main-dashboard').classList.remove('hidden');
  location.reload();
});
</script>
</body>
</html>
